<!DOCTYPE html>
<html>
<head>
<title>Road Hazard Detection</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-dark text-white">

<div class="container mt-5">

<h3>Upload Video</h3>

<input type="file" id="videoUpload" class="form-control mb-3">
<button class="btn btn-warning w-100" onclick="uploadVideo()">Upload & Process</button>
<button class="btn btn-success w-100 mt-2" onclick="downloadVideo()">Download Processed Video</button>
<button class="btn btn-primary w-100 mt-2" onclick="downloadPDF()">Export PDF</button>

<hr>

<p>Detections: <span id="det">0</span></p>
<p>Status: <span id="status">GOOD</span></p>

</div>

<audio id="alarmSound">
<source src="/static/alarm.wav" type="audio/wav">
</audio>

<script>
let alarm=document.getElementById("alarmSound");

function uploadVideo(){
let file=document.getElementById("videoUpload").files[0];
let formData=new FormData();
formData.append("video",file);

fetch('/upload',{
method:"POST",
body:formData
})
.then(res=>res.json())
.then(data=>{
alert("Processing finished\nFrames: "+data.frames+"\nDetections: "+data.detections);
});
}

function downloadVideo(){
window.location.href="/download_video";
}

function downloadPDF(){
window.location.href="/export_pdf";
}

function updateStats(){
fetch('/stats')
.then(res=>res.json())
.then(data=>{
document.getElementById("det").innerText=data.detections;
document.getElementById("status").innerText=data.condition;

if(data.alarm){
alarm.play();
}else{
alarm.pause();
alarm.currentTime=0;
}
});
}

setInterval(updateStats,1000);
</script>

</body>
</html>
