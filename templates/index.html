<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Road Hazard Detection Dashboard</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
    background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    color:white;
}
.glass {
    background:rgba(255,255,255,0.1);
    backdrop-filter:blur(10px);
    border-radius:15px;
    padding:20px;
}
.footer {
    position:fixed;
    bottom:10px;
    right:20px;
    font-size:14px;
    opacity:0.8;
}
.alert-popup {
    position:fixed;
    top:20px;
    right:20px;
    background:red;
    padding:15px 25px;
    display:none;
    animation:pulse 1s infinite;
}
@keyframes pulse{
    0%{transform:scale(1)}
    50%{transform:scale(1.1)}
    100%{transform:scale(1)}
}
.status-good{color:#00ff88;font-weight:bold}
.status-moderate{color:#ffcc00;font-weight:bold}
.status-danger{color:#ff4444;font-weight:bold}
</style>
</head>

<body>

<div class="alert-popup" id="popup">ðŸš¨ HAZARD DETECTED</div>

<nav class="navbar navbar-dark bg-dark px-4">
<span class="navbar-brand">ðŸš§ Road Hazard Detection System</span>
</nav>

<div class="container mt-4">

<div class="glass mb-3">
<input type="file" id="videoUpload" class="form-control mb-2">
<button class="btn btn-warning w-100" onclick="uploadVideo()">Upload Video</button>
</div>

<div class="glass mb-4">
<img src="/video" width="100%">
</div>

<div class="glass mb-3">
<p>FPS: <span id="fps">0</span></p>
<p>Detections: <span id="det">0</span></p>
<p>Status: <span id="roadStatus">GOOD</span></p>
<button class="btn btn-success mt-2" onclick="downloadPDF()">ðŸ“„ Export PDF</button>
</div>

<canvas id="chart"></canvas>

</div>

<div class="footer">
Developed by Achanta Bhanu Vamsi
</div>

<audio id="alarmSound">
<source src="/static/alarm.wav" type="audio/wav">
</audio>

<script>
let popup=document.getElementById("popup");
let alarmAudio=document.getElementById("alarmSound");

let ctx=document.getElementById('chart').getContext('2d');
let chart=new Chart(ctx,{
type:'line',
data:{labels:[],datasets:[{label:'Detections',data:[],borderColor:'red'}]}
});

function uploadVideo(){
let file=document.getElementById("videoUpload").files[0];
let formData=new FormData();
formData.append("video",file);

fetch('/upload',{
method:"POST",
body:formData
});
}

function downloadPDF(){
window.location.href="/export_pdf";
}

function updateStats(){
fetch('/stats')
.then(res=>res.json())
.then(data=>{

document.getElementById("fps").innerText=data.fps;
document.getElementById("det").innerText=data.detections;

let status=document.getElementById("roadStatus");
status.innerText=data.condition;

if(data.alarm){
popup.style.display="block";
alarmAudio.loop=true;
alarmAudio.play();
}else{
popup.style.display="none";
alarmAudio.pause();
alarmAudio.currentTime=0;
}

if(chart.data.labels.length>15){
chart.data.labels.shift();
chart.data.datasets[0].data.shift();
}
chart.data.labels.push('');
chart.data.datasets[0].data.push(data.detections);
chart.update();

});
}

setInterval(updateStats,500);
</script>

</body>
</html>